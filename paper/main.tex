\documentclass[runningheads]{llncs}
%
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{package/mathpartir}


\begin{document}
%
\title{A formal approach in train regulation}
%
%\titlerunning{Abbreviated paper title}
% If the paper title is too long for the running head, you can set
% an abbreviated paper title here
%
\author{Guillaume Bonfante \and Martin Vassor  \and Lucas Villaume}
%
\authorrunning{G. Bonfante et al.}
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%
\institute{Université de Lorraine -- CNRS -- LORIA}
%
\maketitle
%
\begin{abstract}
	...

\keywords{First keyword  \and Second keyword \and Another keyword.}
\end{abstract}


\section{Introduction}
\label{sec:introduction}

This contribution finds its origin in a cyber-warefare we are organising for the IT students at the University of Lorraine, see~\cite{CHE}. In the game-play, we have both IT infrastructures and physical systems, with connections between them. On the physical side, we built a small train network that tries to be a good model of real systems.  Our system manages customer informations, train regulation and finally rail infrastructure. Attackers can hit any of the three parts: disfiguring the site, changing a platform or blocking a signal. Defenders will protect their system, typically via a strict network policy.

\medskip

\begin{wrapfigure}[6]{r}{0.45\textwidth}
\vspace{-6mm}
\includegraphics[height=20mm]{TrainSchema.png}
\end{wrapfigure}


From an IT point of view, our system is shaped as shown on the right. Switches are controlled by a raspberry (TURNOUT) running an OpenPLC program, signals are controlled by an other raspberry and both communicate via modbus. The SIGNAL automaton reads mouvement sensors outputs (not all links shown in the figure). Next to that, we have a third machine, the regulator: it is in charge of updating train routes (as required by the customer IT),  of the regulation of turnouts and finally it may lock some signal (turn it to "red"). All the network connections are done via a single switch, connections from REGULATOR to TURNOUT and SIGNAL are done via modbus while the customer IT and the regulator talks  are based on TCP/IP.  To activate train mouvements, we use the DCC protocol via an Arduino, but this part is strictly related to the fact we have a model train. 


\begin{wrapfigure}[7]{r}{0.3\textwidth}
\hspace{-10mm}
 \begin{minipage}{0.3\textwidth}
        \centering
        \vspace{-24mm}
\includegraphics[height=50mm]{ZoomAffichage.png}
    \end{minipage}
\end{wrapfigure}

 The customer IT is deported from the infrastructure (thus the cloud).  It is itself composed of three machines: one for the station screens, one for the databases and a final orchestrator. On the orchestrator, there are two main services: we have a web-service (with front and backend, on the right) and the general route scheduler.  Our model is completely automatic, no manual intervention is needed apart from minor mechanical problems that come with our scale model.
 
\begin{wrapfigure}[8]{r}{0.28\textwidth}
 \begin{minipage}{0.28\textwidth}
        \centering
        \vspace{-1mm}
\includegraphics[height=50mm]{maquette.png}
    \end{minipage}
\end{wrapfigure}

Final words on the N-scale model. Our circuit has 8 blocks, 5 switches. Each block is bidirectional with a signal at each end.  We operate  three trains in parallel. Due to the size of the model, we reduced our signals  to "red" and "green" status, the train being too close one from the other. Furthermore, in case of a red signal, we make the hypothesis that the train will be able to stop before it reaches the end of the block. In practice, we stop the trains in the middle. 


Routes are not computed in advance. The schedule is renewed every "day"\footnote{We use a time scale factor: one of our "day" corresponds to 20 minutes in real time.}  and we introduce some randomness in the process: some trains are inserted, some trains departure/destination may change, and so on. Finally, in our model, we distinguish freight and  passengers routes giving priority to the latter. Routes are computed each time a train as finished its duty. 
 
 Now, we can enter in more details about how the train regulation works. First, for trains, we have a simple policy.  The regulator will ask the train to start in some direction (Forward/Backward). Then, the train will continue until a signal stops it and then restart when the signal turns green. It will do that up to its arrival point. On the other side, the regulator will, depending on the position of the trains, change switches position, lock/unlock some signal, ask for a train departure. All these operations are done by what we call an order. Trains Orders have the shape "Start direction Until position". Regulator orders are: XXX
 
  We do not make hypotheses on the durations of travels, but once a train is started and not stopped at some point, it will reach in finite time the next block. 
 
 
 
 


% ############################# %
% Espace réservé aux encadrants %
% ############################# %



\section{Modèle informel}
\label{sec:informal-model}


\newpage

\section{Modèle formel}
\label{sec:formal-model}


\subsection{Mosélisation d'une liste d'odre}
La modélisation de notre liste d'ordre doit prendre en compte les besoins et contraintes évoqués plus haut.
Pour cela, nous avons choisi de la représenter comme cela : $O = \{\Gamma, R\}$, avec $\Gamma$ l'ensemble des trains et $R$ notre régulateur.
Chaque train peut être représenté par un identifiant unique, une position, une direction et son programme : $t = (id, pos, dir, P)$, avec $t \in \Gamma$.
Le régulateur, portant une grande partie de la logique du modèle, se représente de manière plus complexe : $R = (E,T,S,W,G,H,TL)$.
%##########
%Définit ce qu'est un event à ce moment ou plus haut ?
%##########
Nous ne détaillerons pas l'ensemble des éléments de $R$ ici, mais nous pouvons en donner un aperçu rapide : $E$ contient l'ensemble des events,
$T$ le token courant pour chaque ressource et $H$ la dernière position connue de chaque train par le régulateur.

Idée: Pourquoi besoin des jetons ? Plusieurs trains peuvent attendre la même ressource critique, il faut donc créer un "ordre de passage".
Avoir un unique token par ressource complexifie les règles.


\subsection{Règles de transitions}
Nous avons défini formellement la modélisation du système, il est temps d'ajouter du mouvement à notre modèle.
Une règle de transition nous permet de définir de manière formelle une évolution du système. 
Si l'on note notre état de base $e$ alors une règle de transition $r$ nous emmène dans un état différent $e'$. On a donc $r: e \rightarrow e'$.
Cependant, nous voulons ajouter des conditions, le train n'avance que si le feu est vert $r:$ \inferrule{feu = vert}{e \rightarrow e'}.
\\Dans notre modèle, nous avons plusieurs sémantiques, une pour les trains, une pour le régulateur et une pour le système.
Ainsi, le régulateur et les trains sont isolés, permettant une approche plus proche de la réalité.

%Montrer les déplacements d'un train
\noindent
\\Start : 
\\Stop : 
\\Until : 
\\Until$_{cons}$ : 

%Quelques régles du régulateur
\noindent
\\Recv : 
\\Incr$_{af}$ :



\subsection{Détecter les problèmes}
Cette section est particulièrement importante, modéliser les problèmes que l'on peut rencontrer permet de les détecter.
Cette phrase peut paraître évidente, mais elle est centrale dans notre méthodologie. Ici, nous pouvons faire face à deux problèmes : 
les trains n'arrivent pas destination, c'est un deadlock, ou les trains partagent une même ressource, c'est un crash. 
Point important, nos règles de transitions se basent sur l'interleaving, les trains ne peuvent donc pas se croiser. (($\triangle$,2)->($\triangle$,3) || ($O$,3)->($O$,2)).
Le premier problème représente notre propriété de Liveness, les trains arrivent à destination, et le second représente notre propriété de Safety, les trains ne se crashent pas.

\section{Formalisation en TLA}
\label{sec:tla-formalisation}

\section{Composition}
\label{sec:composition}

\section{Expériences}
\label{sec:experiments}

\newpage

\section{Conclusion}
\label{sec:conclusion}

%temporaire, histoire d'avoir le sommaire en tête
\includegraphics[scale=0.1]{img/sommaire_tableau.jpg}


\bibliographystyle{splncs04}
\bibliography{refs}
\end{document}
